---
layout: post
comments: true
title: Conversion rate и закон больших чисел
---

Этот пост по большей части является вольным переводом статьи **[Monitoring Bookings and the Law of Large Numbers]**. 


При мониторинге конверсий (доли конверсий) одним из распространенных подходов к аналитике является использование исторических данных в качестве основы для оценки общей картины. В этом случае, считается, что нужно беспокоиться, если текущее значение нужного показателя на x% ниже, чем некий исторический уровень.
Иногда заметно, что выбор ориентира на основе истории приводит к ошибочным выводам или не учитывает какие-то важные факторы. 


Тогда какую оценку следует использовать?


###Бросание монеты


Начнем с простого - рассмотрим классический эксперимент с бросанием монеты

Предположим, что вам предлагают определить, насколько симметрична монета. Для этого вы подбрасываете ее 6 раз, результат следующий: О Р Р О О О. Другими словами, 67% орел и 33 решка. Симметрична ли монета?

Очевидно, что после такого эксперимента нельзя точно ответить на этот вопрос. И симметричная и смещенная монеты могут давать такой результат
Теперь предположим, что мы проведем эксперимент 1000 раз, в результате получим 667 орлов и 333 решки. 
Такая монета наверняка несимметрична. При этом интуитивно мы достаточно уверены, что вероятность появления орла близка к 2/3.
В каждом эксперименте шанс выпадания орла был 67%, а решки 33%, но в первом случае мы не могли сделать однозначный вывод по поводу монеты, однако, во втором случае ситуация была ясна как день. В чем же разница?


Разница в размере выборки. В статистике это понятие относится к [закону больших чисел], который говорит о том, что чем больше размер выборки, тем ближе среднее этой выборки к фактическому среднему. В нашей ситуации мы имеем дело с долями выборки (доля орлов и решек в общем числе бросков), а не со средними, для этого существует [борелевский закон больших чисел:] доля события (например, появления орла) стремится к фактическому значению с увеличением размера выборки.
На малых выборках закон больших чисел не работает, поэтому доля орлов (или решек) не может служить оценкой симметричности монетки. С другой стороны, если мы наблюдаем 667 орлов и 333 решки, то нет смысле сомневаться в том, что монета несимметрична, таков закон (больших чисел). 
Бросание монетки - классический пример биномиального эксперимента ( a.k.a. [эксперимента Бернулли]). В биномиальном эксперименте проводится **n** испытаний. Каждое имеет два возможных исхода (орел и решка, в нашем случае), с соответствующими вероятностями этих исходов.
Говоря на языке статистики, первый эксперимент состял из n = 6 испытаний, мы хотели проверить гипотезу, о том, что вероятность каждого исхода p = 0.5. Второй эксперимент состоял из n = 1000 испытаний и имел целью проверить аналогичную гипотезу относительно p.


Как это может помочь нам в анализе конверсий?


###Применение закона больших чисел к конверсиям


Мы можем говорить о конверсиях как о биномиальных экспериментах. На заданном временном промежутке мы наблюдаем определенное число посетителей и они либо конвертятся, либо нет. Вероятность конверсии и называют *долей (коэффициентом) конверсии*. Чаще всего она гораздо ниже 0.5; p = 0.03 гораздо более типичный случай. Несмотря на это предпосылки биномиального эксперимента не нарушаются. 
Давайте теперь представим, что клиент предлагает набор различных продуктов посредством разных сайтов (например, .ru, .com, .рф и т.д.) и разных каналов. Также предположим, что трафик зависит от времени суток, дня недели и даже от времени года. Это довольно типичная ситуация. 
Мы хотим отслеживать конверсии по всем возможным таким комбинациям, хотя бы по самым важным из них. Проще говоря, допустим, что нам нужно отслеживать сайт main.com в рамках суток, днем посещений много, ночью гораздо меньше. 
В течение дня трафик велик, соответственно, мы имеем большие размеры выборки (n). Предполагая, что количество посещений и коэффициент конверсий на протяжении нескольких недель резко не менялись, можно сослаться на закон больших чисел и использовать исторические данные для расчета доли конверсий в посещениях, чтобы оценить коэффициент конверсий. 
Ночью же трафик низкий, поэтому выборку скорее следует отнести к классу малых выборок (низкий n). В такой ситуации закон больших чисел уже не поможет. В данном случае мы имеем ситуауцию близкую к 6 орлам из 10 бросков: ни о чем нельзя утверждать уверенно. 
В качестве примера мы рассуждали в масштабе суток, однако, эту логику можно распространять и на другие временные шкалы (неделя, месяц, год и т.д.).


Теперь становится более понятно, что точечные оценки не могут корректно оценить истинные значения некоторых параметров. В контексте большой выборки использование точечной оценки даст небольшую погрешность (узкий доверительный интервал), и мы иногда можем использовать такую оценку в бизнес-процессах. Но если выборка малая, то границы, в рамках которых с высокой долей вероятности будет находится искомое истинное значение параметра будут очень широкими. 
Таким образом, использование точечных оценок коэффициента конверсии может приводить к значительным ошибкам. Как с этим бороться? Отличное решение предложено по ссылке в комментарии к [оригинальному посту]. Если интересует менее техническое описание решения, рады будем [помочь]



[Monitoring Bookings and the Law of Large Numbers]: http://williewheeler.com/2015/05/16/monitoring-bookings-and-the-law-of-large-numbers/
[закону больших чисел]: https://en.wikipedia.org/wiki/Law_of_large_numbers
[борелевский закон больших чисел:]: https://en.wikipedia.org/wiki/Law_of_large_numbers#Borel.27s_law_of_large_numbers
[эксперимента Бернулли]: https://en.wikipedia.org/wiki/Bernoulli_trial
[оригинальному посту]: http://williewheeler.com/2015/05/16/monitoring-bookings-and-the-law-of-large-numbers/
[помочь]: http://realwebanalytics.github.io/about/
